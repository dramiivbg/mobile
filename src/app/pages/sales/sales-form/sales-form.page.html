<ion-header>
  <ion-toolbar color="plureMain">
    <ion-buttons slot="start">
      <ion-back-button class="ion-toolbar-button" defaultHref="modules"></ion-back-button>
    </ion-buttons>
    <ion-title *ngIf="new">New - {{process.processName}}</ion-title>
    <ion-title *ngIf="!new">{{process.processName}} - {{order.id}}</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <form [formGroup]="frm" (ngSubmit)="onSubmit()">

    <div class="designform-header">
      <ion-row>
        <ion-col *ngIf="new" (click)="onCustomer()">
          <ion-label class="customerName" *ngIf="frm.controls.customerNo.value == ''">____________</ion-label>
          <ion-label class="customerName" *ngIf="frm.controls.customerNo.value != ''">{{frm.controls.customerName.value}}</ion-label>
        </ion-col>
        <ion-col *ngIf="!new">
          <ion-label class="customerName">{{frm.controls.customerName.value}}</ion-label>
        </ion-col>
      </ion-row>
      <ion-row class="customerNo">
        <ion-col>
          <ion-label class="smallfont">Customer No {{frm.controls.customerNo.value}}</ion-label>
        </ion-col>
      </ion-row>
      <ion-row class="shipTop">
        <ion-col (click)="onShipAddress()" *ngIf="new">
          <ion-label class="smallfont">Ship-to Address.</ion-label>
          <ion-label class="smallfont" *ngIf="frm.controls.shippingNo.value == ''"> ___________</ion-label>
          <ion-label class="smallfont" *ngIf="frm.controls.shippingNo.value != ''"> {{frm.controls.shippingNo.value}} - {{frm.controls.shippingName.value}}</ion-label>
        </ion-col>
        <ion-col *ngIf="!new">
          <ion-label class="smallfont">Ship-to Address. </ion-label>
          <ion-label class="smallfont">{{frm.controls.shippingNo.value}} - {{frm.controls.shippingName.value}}</ion-label>
        </ion-col>
      </ion-row>
      <ion-row class="orderDate">
        <ion-col size="4">
          <ion-label class="smallfont">
            Order date: 
          </ion-label>
        </ion-col>
        <ion-col size="3">
          <ion-label class="smallfont" *ngIf="new">
            <ion-datetime class="smallfont" formControlName="orderDate" display-format="MM/DD/YYYY" pickerFormat="MM DD YYYY"></ion-datetime>
          </ion-label>
          <ion-label class="smallfont" *ngIf="!new">
            {{ frm.controls.orderDate.value | date: 'dd/MM/yyyy' }}
          </ion-label>
        </ion-col>
      </ion-row>
      <ion-row class="delivery">
        <ion-col size="4">
          <ion-label class="smallfont">
            Delivery date: 
          </ion-label>
        </ion-col>
        <ion-col size="3">
          <ion-label class="smallfont" *ngIf="new">
            <ion-datetime class="smallfont" formControlName="requestedDeliveryDate" display-format="MM/DD/YYYY" pickerFormat="MM DD YYYY"></ion-datetime>
          </ion-label>
          <ion-label class="smallfont" *ngIf="!new">
            {{ frm.controls.requestedDeliveryDate.value | date: 'dd/MM/yyyy' }}
          </ion-label>
        </ion-col>
            <!-- {{ today | date: 'dd/MM/yyyy' }} -->
      </ion-row>
      <ion-row class="total-for-pay">
        <ion-col>
          <ion-label>${{total}}</ion-label>
        </ion-col>
      </ion-row>
    </div>

    <div class="accorn">
      <div class="order-details">
        <ion-row>
          <ion-col size="3" class="txt">
            <ion-label>Lines</ion-label>
          </ion-col>
          <ion-col *ngIf="new">
            <ion-button class="add-lines" color="plure" (click)="onItem()" type="button">+</ion-button>
          </ion-col>
        </ion-row>
      </div>
      <div  class="accorn-body">
        <div formArrayName="lines" class="lines">
          <!-- <ion-list *ngFor="let item of frm.get('lines')['controls']; let i=index"> -->
          <ion-list *ngFor="let item of frm.get('lines')['controls']; let i=index">
            <div [formGroupName]="i" *ngIf="item.controls.title.value != ''">
              
              <ion-item-sliding>
                <ion-item-options *ngIf="new" side="start">
                  <ion-item-option color="danger" (click)="onDeleteLine(i)" style="padding: 0 50px;">Delete</ion-item-option>
                </ion-item-options>

                <ion-item>
                  <ion-label class="label-lines">
                    <ion-row>
                      <ion-col size="2" class="label-line-title">
                        <img *ngIf="item.controls.picture.value == 'data:image/jpeg;base64,NOIMAGE'" src="../../../../assets/img/NOIMAGE.jpg" />
                        <img *ngIf="item.controls.picture.value != 'data:image/jpeg;base64,NOIMAGE'" src="{{item.controls.picture.value}}" />
                      </ion-col>
                      <ion-col size="10">
                        <ion-row>
                          <ion-col size="7" style="overflow: hidden;" class="label-line-title">
                            {{item.controls.title.value}}
                          </ion-col>
                          <ion-col size="5" class="label-line-title" style="text-align: right;">
                            Total ${{item.controls.total.value}}
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col size="4" class="label-line">
                            Item No: {{item.controls.id.value}}
                          </ion-col>
                          <ion-col class="label-line">
                            Discount: {{item.controls.lineDiscountPercentage.value}}%
                          </ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col size="4" class="label-line">
                            Quantity: {{item.controls.quantity.value}}
                          </ion-col>
                          <ion-col class="label-line">
                            Unit price: ${{item.controls.unitPrice.value}}
                          </ion-col>
                        </ion-row>
                      </ion-col>
                    </ion-row>                    
                  </ion-label>
                </ion-item>

                <ion-item-options side="end" *ngIf="new">
                  <ion-item-option color="danger">
                    <ion-select style="width: 150px;" (ionChange)="ionMeasure(i)" formControlName="unitOfMeasureCode">
                      <ion-select-option *ngFor="let measure of unitMeasureList[i]">{{measure.id}}</ion-select-option>
                    </ion-select>
                  </ion-item-option>
                  <ion-item-option class="item-lines" color="plureBlack">
                    <ion-button color="plureGrey" class="btn-decrement" (click)="onIncDec(i, 0)">-</ion-button>
                    <ion-input color="plureBlack" formControlName="quantity" type="number"></ion-input>
                    <ion-button color="plureGrey" class="btn-increment" (click)="onIncDec(i, 1)">+</ion-button>
                  </ion-item-option>
                </ion-item-options>
              </ion-item-sliding>
            </div>
          </ion-list>
        </div>
      </div>
    </div>

    <div class="accorn">
      <ion-row>
        <ion-col size="7"></ion-col>
        <ion-col size="2">
          <ion-label>Subtotal</ion-label>
        </ion-col>
        <ion-col size="2" style="text-align: right;">${{subTotal}}</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="7"></ion-col>
        <ion-col size="2">
          <ion-label>Tax</ion-label>
        </ion-col>
        <ion-col size="2" style="text-align: right;">${{taxTotal}}</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="7"></ion-col>
        <ion-col size="2">
          <ion-label>Discount</ion-label>
        </ion-col>
        <ion-col size="2" style="text-align: right;">${{discountTotal}}</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size="7"></ion-col>
        <ion-col size="2">
          <ion-label>Total</ion-label>
        </ion-col>
        <ion-col size="2" style="text-align: right;">${{total}}</ion-col>
      </ion-row>
    </div>

    <div class="accorn accorn-fields-dynamics" style="display: none;">
      <div class="accorn-title">
        Fields
      </div>
      <div class="accorn-body">

        <div *ngFor="let field of fields">

          <ion-grid>
            <ion-row>
              <ion-col *ngIf="!field.system && field.type != 'date'">
                <ion-item>
                  <ion-label position="floating">{{field.name}}</ion-label>
                  <ion-input [max]="field.length" [type]="field.type" [formControlName]="field.id"></ion-input>
                </ion-item>
              </ion-col>
              <ion-col *ngIf="!field.system && field.type == 'date'">
                <ion-item>
                  <ion-label position="floating">{{field.name}}</ion-label>
                  <ion-datetime [formControlName]="field.id" placeholder="Select your date" display-format="MM/DD/YYYY"
                    pickerFormat="MM DD YYYY"></ion-datetime>
                </ion-item>
              </ion-col>
            </ion-row>
          </ion-grid>

        </div>

      </div>
    </div>

    <ion-row *ngIf="new">
      <ion-col>
        <ion-button type="submit" color="light" class="btn-submit">
          Submit
        </ion-button>
      </ion-col>
    </ion-row>


  </form>

</ion-content>

<ion-toolbar color="plureMain">
  <ion-buttons slot="primary">
    <ion-button (click)="onBarCode()">
      <ion-icon name="barcode-outline"></ion-icon>
    </ion-button>
  </ion-buttons>
</ion-toolbar>
